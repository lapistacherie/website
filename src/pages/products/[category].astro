---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import ProductCard from '../../components/ProductCard.astro';
import { getCollection } from 'astro:content';

const base = import.meta.env.BASE_URL;

export async function getStaticPaths() {
  const allProducts = await getCollection('products');

  const categories = ['everyday-gourmet', 'jar-collection', 'signature-collection', 'festive-gifting'];

  return categories.map(category => {
    const categoryProducts = allProducts.filter(
      product => product.data.category === category
    );

    return {
      params: { category },
      props: { products: categoryProducts, category },
    };
  });
}

const { products, category } = Astro.props;

const categoryInfo: Record<string, { title: string; image: string }> = {
  'everyday-gourmet': {
    title: 'Everyday Gourmet',
    image: `${base}/images/collections/everyday-gourmet.jpg`,
  },
  'jar-collection': {
    title: 'Jar Collection',
    image: `${base}/images/collections/jar-collection.jpg`,
  },
  'signature-collection': {
    title: 'Signature Collection',
    image: `${base}/images/collections/signature-collection.jpg`,
  },
  'festive-gifting': {
    title: 'Festive Gifting',
    image: `${base}/images/collections/festive-gifting.jpg`,
  },
};

const info = categoryInfo[category] || { title: category, image: '' };
---

<Layout title={`${info.title} - La Pistacherie`}>
  <Header />

  <main>
    <!-- Category Hero Banner -->
    {info.image && (
      <section class="parallax-section" style={`background-image: url(${info.image});`}>
        <div class="parallax-overlay">
          <div class="container mx-auto px-4 max-w-7xl">
            <h1 class="text-3xl md:text-5xl lg:text-6xl font-bold text-white">
              {info.title}
            </h1>
          </div>
        </div>
      </section>
    )}

    <!-- Products Grid -->
    <div class="py-16">
      <div class="container mx-auto px-4 max-w-7xl">

      {products.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
          {products.map((product) => (
            <ProductCard
              title={product.data.title}
              price={product.data.price}
              category={product.data.category}
              slug={product.slug}
              image={product.data.images[0]}
              featured={product.data.featured}
              hasVariants={product.data.variants && product.data.variants.length > 1}
            />
          ))}
        </div>
      ) : (
        <div class="text-center py-16">
          <p class="text-gray-500 text-lg">
            No products available in this category yet.
          </p>
          <a
            href="/products"
            class="inline-block mt-6 bg-[#39441E] text-white px-6 py-3 rounded-md font-semibold hover:bg-[#003A15] transition-colors"
          >
            View All Products
          </a>
        </div>
      )}
      </div>
    </div>
  </main>

  <Footer />
</Layout>

<style>
  /* Parallax section with fixed background */
  .parallax-section {
    height: 24rem; /* h-96 */
    position: relative;
    background-attachment: fixed;
    background-position: center;
    background-repeat: no-repeat;
    background-size: cover;
  }

  @media (min-width: 768px) {
    .parallax-section {
      height: 36rem; /* md:h-[36rem] */
    }
  }

  @media (min-width: 1024px) {
    .parallax-section {
      height: 44rem; /* lg:h-[44rem] */
    }
  }

  /* Content overlay */
  .parallax-overlay {
    height: 100%;
    display: flex;
    align-items: flex-end;
    padding-bottom: 2rem;
    background: linear-gradient(
      to top,
      rgba(0, 0, 0, 0.7),
      rgba(0, 0, 0, 0.4),
      transparent
    );
  }

  @media (min-width: 768px) {
    .parallax-overlay {
      padding-bottom: 3rem;
    }
  }

  /* Mobile fallback - disable fixed attachment on mobile devices */
  @media (max-width: 767px) {
    .parallax-section {
      background-attachment: scroll;
    }
  }
</style>
